<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NightForge Tree API Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --nf-gray-900: #0D0F16;
            --nf-gray-800: #151823;
            --nf-gray-700: #1F2330;
            --nf-gray-600: #2A3042;
            --nf-gray-400: #6B7287;
            --nf-gray-200: #B7BBD0;
            --nf-gray-100: #E7E9F6;
            --nf-primary-500: #7F5CFF;
            --nf-primary-300: #B39AFE;
            --nf-primary-700: #5941C6;
            --nf-accent-cyan: #22D6F3;
            --nf-accent-pink: #FF4F9C;
            --nf-success: #24D18B;
            --nf-warning: #FFC76B;
            --nf-error: #FF517B;
            --nf-ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --nf-dur-fast: 120ms;
            --nf-dur-medium: 240ms;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--nf-gray-900);
            color: var(--nf-gray-200);
        }
        
        .font-display {
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .nf-card {
            background: var(--nf-gray-800);
            border: 1px solid var(--nf-gray-700);
            box-shadow: 0 2px 6px -1px rgba(0,0,0,0.5), 0 1px 1px rgba(0,0,0,0.2);
            transition: all var(--nf-dur-medium) var(--nf-ease-out);
        }
        
        .nf-card:hover {
            box-shadow: 0 8px 24px -4px rgba(0,0,0,0.75), 0 2px 6px -2px rgba(0,0,0,0.3);
        }
        
        .nf-btn-primary {
            background: var(--nf-primary-500);
            color: white;
            transition: all var(--nf-dur-fast) var(--nf-ease-out);
        }
        
        .nf-btn-primary:hover {
            background: var(--nf-primary-300);
            box-shadow: 0 0 8px 2px rgba(127, 92, 255, 0.3);
        }
        
        .nf-btn-secondary {
            background: transparent;
            border: 1px solid var(--nf-gray-600);
            color: var(--nf-gray-200);
            transition: all var(--nf-dur-fast) var(--nf-ease-out);
        }
        
        .nf-btn-secondary:hover {
            border-color: var(--nf-primary-500);
            box-shadow: 0 0 6px 1px rgba(127, 92, 255, 0.2);
        }
        
        .tag-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 0.125rem;
        }
        
        .tag-cluster { background: var(--nf-primary-500); color: white; }
        .tag-area { background: var(--nf-accent-cyan); color: var(--nf-gray-900); }
        .tag-status-active { background: var(--nf-success); color: var(--nf-gray-900); }
        .tag-status-inactive { background: var(--nf-gray-600); color: var(--nf-gray-200); }
        
        .tree-node {
            cursor: pointer;
            transition: all var(--nf-dur-fast) var(--nf-ease-out);
        }
        
        .tree-node:hover {
            transform: scale(1.05);
        }
        
        .tree-link {
            fill: none;
            stroke: var(--nf-gray-600);
            stroke-width: 2px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 var(--nf-accent-cyan); }
            50% { box-shadow: 0 0 8px 6px rgba(34, 214, 243, 0.3); }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        .filter-active {
            background: var(--nf-primary-500) !important;
            color: white !important;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-6 py-8 max-w-7xl">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="font-display text-4xl font-semibold mb-2" style="color: var(--nf-primary-300)">
                ðŸŒ‘ NightForge Tree API
            </h1>
            <p class="text-lg" style="color: var(--nf-gray-400)">
                Interactive demonstration of tree-structured data management
            </p>
        </header>

        <!-- Controls Panel -->
        <div class="nf-card rounded-lg p-6 mb-8">
            <h2 class="font-display text-xl font-semibold mb-4">Controls & Filters</h2>
            <div class="flex flex-wrap gap-4 mb-4">
                <select id="treeSelect" class="px-4 py-2 rounded-lg border" style="background: var(--nf-gray-700); border-color: var(--nf-gray-600); color: var(--nf-gray-200)">
                    <option value="all">All Trees</option>
                </select>
                
                <button id="filterActive" class="nf-btn-secondary px-4 py-2 rounded-lg">
                    Active Only
                </button>
                
                <button id="filterClusters" class="nf-btn-secondary px-4 py-2 rounded-lg">
                    Clusters
                </button>
                
                <button id="filterAreas" class="nf-btn-secondary px-4 py-2 rounded-lg">
                    Areas
                </button>
                
                <button id="resetFilters" class="nf-btn-primary px-4 py-2 rounded-lg">
                    Reset Filters
                </button>
            </div>
            
            <div class="flex items-center gap-4">
                <input type="text" id="searchInput" placeholder="Search tags, clusters, areas..." 
                       class="px-4 py-2 rounded-lg border flex-1" 
                       style="background: var(--nf-gray-700); border-color: var(--nf-gray-600); color: var(--nf-gray-200)">
                <button id="expandAll" class="nf-btn-secondary px-4 py-2 rounded-lg">
                    Expand All
                </button>
                <button id="collapseAll" class="nf-btn-secondary px-4 py-2 rounded-lg">
                    Collapse All
                </button>
            </div>
        </div>

        <!-- Stats Dashboard -->
        <div class="stats-grid mb-8">
            <div class="nf-card rounded-lg p-6">
                <h3 class="font-display text-lg font-semibold mb-2">Total Trees</h3>
                <div class="text-3xl font-bold" style="color: var(--nf-primary-300)" id="statTrees">3</div>
            </div>
            <div class="nf-card rounded-lg p-6">
                <h3 class="font-display text-lg font-semibold mb-2">Total Clusters</h3>
                <div class="text-3xl font-bold" style="color: var(--nf-accent-cyan)" id="statClusters">8</div>
            </div>
            <div class="nf-card rounded-lg p-6">
                <h3 class="font-display text-lg font-semibold mb-2">Total Areas</h3>
                <div class="text-3xl font-bold" style="color: var(--nf-success)" id="statAreas">30</div>
            </div>
            <div class="nf-card rounded-lg p-6">
                <h3 class="font-display text-lg font-semibold mb-2">Active Tags</h3>
                <div class="text-3xl font-bold" style="color: var(--nf-warning)" id="statTags">45</div>
            </div>
        </div>

        <!-- Tree Visualization -->
        <div class="nf-card rounded-lg p-6 mb-8">
            <h2 class="font-display text-xl font-semibold mb-4">Tree Structure Visualization</h2>
            <div id="treeViz" class="w-full" style="min-height: 600px;"></div>
        </div>

        <!-- Tag Cloud -->
        <div class="nf-card rounded-lg p-6 mb-8">
            <h2 class="font-display text-xl font-semibold mb-4">Tag Cloud</h2>
            <div id="tagCloud" class="flex flex-wrap gap-2"></div>
        </div>

        <!-- Detailed Data View -->
        <div class="nf-card rounded-lg p-6">
            <h2 class="font-display text-xl font-semibold mb-4">Data Inspector</h2>
            <div id="dataInspector" class="space-y-4"></div>
        </div>
    </div>

    <script>
        // Seed Data
        const seedData = {
            trees: [
                {
                    id: "tree_001",
                    name: "Enterprise Architecture",
                    status: "active",
                    created_at: "2024-01-15T10:30:00Z",
                    clusters: [
                        {
                            uid: "cluster_001",
                            name: "Infrastructure",
                            status: "active",
                            parent_id: null,
                            tree_id: "tree_001",
                            children: ["cluster_002", "cluster_003"],
                            areas: ["area_001", "area_002", "area_003", "area_004", "area_005"]
                        },
                        {
                            uid: "cluster_002",
                            name: "Cloud Services",
                            status: "active",
                            parent_id: "cluster_001",
                            tree_id: "tree_001",
                            children: [],
                            areas: ["area_006", "area_007", "area_008", "area_009"]
                        },
                        {
                            uid: "cluster_003",
                            name: "Security",
                            status: "active",
                            parent_id: "cluster_001",
                            tree_id: "tree_001",
                            children: [],
                            areas: ["area_010", "area_011", "area_012"]
                        }
                    ]
                },
                {
                    id: "tree_002",
                    name: "Product Development",
                    status: "active",
                    created_at: "2024-02-01T14:15:00Z",
                    clusters: [
                        {
                            uid: "cluster_004",
                            name: "Frontend",
                            status: "active",
                            parent_id: null,
                            tree_id: "tree_002",
                            children: ["cluster_005"],
                            areas: ["area_013", "area_014", "area_015", "area_016"]
                        },
                        {
                            uid: "cluster_005",
                            name: "UI Components",
                            status: "active",
                            parent_id: "cluster_004",
                            tree_id: "tree_002",
                            children: [],
                            areas: ["area_017", "area_018", "area_019", "area_020"]
                        },
                        {
                            uid: "cluster_006",
                            name: "Backend",
                            status: "active",
                            parent_id: null,
                            tree_id: "tree_002",
                            children: [],
                            areas: ["area_021", "area_022", "area_023", "area_024"]
                        }
                    ]
                },
                {
                    id: "tree_003",
                    name: "Marketing Operations",
                    status: "inactive",
                    created_at: "2024-03-10T09:45:00Z",
                    clusters: [
                        {
                            uid: "cluster_007",
                            name: "Digital Marketing",
                            status: "active",
                            parent_id: null,
                            tree_id: "tree_003",
                            children: ["cluster_008"],
                            areas: ["area_025", "area_026"]
                        },
                        {
                            uid: "cluster_008",
                            name: "Social Media",
                            status: "inactive",
                            parent_id: "cluster_007",
                            tree_id: "tree_003",
                            children: [],
                            areas: ["area_027", "area_028", "area_029", "area_030"]
                        }
                    ]
                }
            ],
            areas: [
                // Infrastructure areas
                { uid: "area_001", name: "Servers", status: "active", cluster_uid: "cluster_001", tags: ["hardware", "infrastructure", "critical"] },
                { uid: "area_002", name: "Networking", status: "active", cluster_uid: "cluster_001", tags: ["network", "infrastructure", "security"] },
                { uid: "area_003", name: "Storage", status: "active", cluster_uid: "cluster_001", tags: ["storage", "backup", "infrastructure"] },
                { uid: "area_004", name: "Monitoring", status: "active", cluster_uid: "cluster_001", tags: ["monitoring", "alerts", "infrastructure"] },
                { uid: "area_005", name: "Load Balancing", status: "active", cluster_uid: "cluster_001", tags: ["performance", "scaling", "infrastructure"] },
                
                // Cloud Services areas
                { uid: "area_006", name: "AWS EC2", status: "active", cluster_uid: "cluster_002", tags: ["aws", "compute", "cloud"] },
                { uid: "area_007", name: "Kubernetes", status: "active", cluster_uid: "cluster_002", tags: ["k8s", "orchestration", "cloud"] },
                { uid: "area_008", name: "Docker", status: "active", cluster_uid: "cluster_002", tags: ["containers", "deployment", "cloud"] },
                { uid: "area_009", name: "Azure Functions", status: "inactive", cluster_uid: "cluster_002", tags: ["serverless", "azure", "cloud"] },
                
                // Security areas
                { uid: "area_010", name: "Authentication", status: "active", cluster_uid: "cluster_003", tags: ["auth", "security", "critical"] },
                { uid: "area_011", name: "Encryption", status: "active", cluster_uid: "cluster_003", tags: ["crypto", "security", "compliance"] },
                { uid: "area_012", name: "Firewall", status: "active", cluster_uid: "cluster_003", tags: ["network", "security", "protection"] },
                
                // Frontend areas
                { uid: "area_013", name: "React Components", status: "active", cluster_uid: "cluster_004", tags: ["react", "frontend", "ui"] },
                { uid: "area_014", name: "State Management", status: "active", cluster_uid: "cluster_004", tags: ["redux", "state", "frontend"] },
                { uid: "area_015", name: "Routing", status: "active", cluster_uid: "cluster_004", tags: ["navigation", "spa", "frontend"] },
                { uid: "area_016", name: "Performance", status: "active", cluster_uid: "cluster_004", tags: ["optimization", "speed", "frontend"] },
                
                // UI Components areas
                { uid: "area_017", name: "Design System", status: "active", cluster_uid: "cluster_005", tags: ["design", "components", "ui"] },
                { uid: "area_018", name: "Forms", status: "active", cluster_uid: "cluster_005", tags: ["input", "validation", "ui"] },
                { uid: "area_019", name: "Navigation", status: "active", cluster_uid: "cluster_005", tags: ["menu", "navigation", "ui"] },
                { uid: "area_020", name: "Data Display", status: "active", cluster_uid: "cluster_005", tags: ["tables", "charts", "ui"] },
                
                // Backend areas
                { uid: "area_021", name: "API Gateway", status: "active", cluster_uid: "cluster_006", tags: ["api", "gateway", "backend"] },
                { uid: "area_022", name: "Database", status: "active", cluster_uid: "cluster_006", tags: ["sql", "nosql", "backend"] },
                { uid: "area_023", name: "Caching", status: "active", cluster_uid: "cluster_006", tags: ["redis", "performance", "backend"] },
                { uid: "area_024", name: "Message Queue", status: "active", cluster_uid: "cluster_006", tags: ["queue", "async", "backend"] },
                
                // Digital Marketing areas
                { uid: "area_025", name: "SEO", status: "active", cluster_uid: "cluster_007", tags: ["seo", "marketing", "organic"] },
                { uid: "area_026", name: "Analytics", status: "active", cluster_uid: "cluster_007", tags: ["data", "metrics", "marketing"] },
                
                // Social Media areas
                { uid: "area_027", name: "Facebook Ads", status: "inactive", cluster_uid: "cluster_008", tags: ["facebook", "ads", "social"] },
                { uid: "area_028", name: "Twitter Campaign", status: "inactive", cluster_uid: "cluster_008", tags: ["twitter", "campaign", "social"] },
                { uid: "area_029", name: "Instagram Marketing", status: "active", cluster_uid: "cluster_008", tags: ["instagram", "visual", "social"] },
                { uid: "area_030", name: "LinkedIn Outreach", status: "active", cluster_uid: "cluster_008", tags: ["linkedin", "b2b", "social"] }
            ],
            tags: [
                // Infrastructure tags
                { slug: "hardware", name: "Hardware", status: "active", tree_id: "tree_001" },
                { slug: "infrastructure", name: "Infrastructure", status: "active", tree_id: "tree_001" },
                { slug: "critical", name: "Critical", status: "active", tree_id: "tree_001" },
                { slug: "network", name: "Network", status: "active", tree_id: "tree_001" },
                { slug: "security", name: "Security", status: "active", tree_id: "tree_001" },
                { slug: "storage", name: "Storage", status: "active", tree_id: "tree_001" },
                { slug: "backup", name: "Backup", status: "active", tree_id: "tree_001" },
                { slug: "monitoring", name: "Monitoring", status: "active", tree_id: "tree_001" },
                { slug: "alerts", name: "Alerts", status: "active", tree_id: "tree_001" },
                { slug: "performance", name: "Performance", status: "active", tree_id: "tree_001" },
                { slug: "scaling", name: "Scaling", status: "active", tree_id: "tree_001" },
                { slug: "aws", name: "AWS", status: "active", tree_id: "tree_001" },
                { slug: "compute", name: "Compute", status: "active", tree_id: "tree_001" },
                { slug: "cloud", name: "Cloud", status: "active", tree_id: "tree_001" },
                { slug: "k8s", name: "Kubernetes", status: "active", tree_id: "tree_001" },
                { slug: "orchestration", name: "Orchestration", status: "active", tree_id: "tree_001" },
                { slug: "containers", name: "Containers", status: "active", tree_id: "tree_001" },
                { slug: "deployment", name: "Deployment", status: "active", tree_id: "tree_001" },
                { slug: "serverless", name: "Serverless", status: "inactive", tree_id: "tree_001" },
                { slug: "azure", name: "Azure", status: "inactive", tree_id: "tree_001" },
                { slug: "auth", name: "Authentication", status: "active", tree_id: "tree_001" },
                { slug: "crypto", name: "Cryptography", status: "active", tree_id: "tree_001" },
                { slug: "compliance", name: "Compliance", status: "active", tree_id: "tree_001" },
                { slug: "protection", name: "Protection", status: "active", tree_id: "tree_001" },
                
                // Product Development tags
                { slug: "react", name: "React", status: "active", tree_id: "tree_002" },
                { slug: "frontend", name: "Frontend", status: "active", tree_id: "tree_002" },
                { slug: "ui", name: "UI", status: "active", tree_id: "tree_002" },
                { slug: "redux", name: "Redux", status: "active", tree_id: "tree_002" },
                { slug: "state", name: "State", status: "active", tree_id: "tree_002" },
                { slug: "navigation", name: "Navigation", status: "active", tree_id: "tree_002" },
                { slug: "spa", name: "SPA", status: "active", tree_id: "tree_002" },
                { slug: "optimization", name: "Optimization", status: "active", tree_id: "tree_002" },
                { slug: "speed", name: "Speed", status: "active", tree_id: "tree_002" },
                { slug: "design", name: "Design", status: "active", tree_id: "tree_002" },
                { slug: "components", name: "Components", status: "active", tree_id: "tree_002" },
                { slug: "input", name: "Input", status: "active", tree_id: "tree_002" },
                { slug: "validation", name: "Validation", status: "active", tree_id: "tree_002" },
                { slug: "menu", name: "Menu", status: "active", tree_id: "tree_002" },
                { slug: "tables", name: "Tables", status: "active", tree_id: "tree_002" },
                { slug: "charts", name: "Charts", status: "active", tree_id: "tree_002" },
                { slug: "api", name: "API", status: "active", tree_id: "tree_002" },
                { slug: "gateway", name: "Gateway", status: "active", tree_id: "tree_002" },
                { slug: "backend", name: "Backend", status: "active", tree_id: "tree_002" },
                { slug: "sql", name: "SQL", status: "active", tree_id: "tree_002" },
                { slug: "nosql", name: "NoSQL", status: "active", tree_id: "tree_002" },
                { slug: "redis", name: "Redis", status: "active", tree_id: "tree_002" },
                { slug: "queue", name: "Queue", status: "active", tree_id: "tree_002" },
                { slug: "async", name: "Async", status: "active", tree_id: "tree_002" },
                
                // Marketing tags
                { slug: "seo", name: "SEO", status: "active", tree_id: "tree_003" },
                { slug: "marketing", name: "Marketing", status: "active", tree_id: "tree_003" },
                { slug: "organic", name: "Organic", status: "active", tree_id: "tree_003" },
                { slug: "data", name: "Data", status: "active", tree_id: "tree_003" },
                { slug: "metrics", name: "Metrics", status: "active", tree_id: "tree_003" },
                { slug: "facebook", name: "Facebook", status: "inactive", tree_id: "tree_003" },
                { slug: "ads", name: "Ads", status: "inactive", tree_id: "tree_003" },
                { slug: "social", name: "Social", status: "active", tree_id: "tree_003" },
                { slug: "twitter", name: "Twitter", status: "inactive", tree_id: "tree_003" },
                { slug: "campaign", name: "Campaign", status: "inactive", tree_id: "tree_003" },
                { slug: "instagram", name: "Instagram", status: "active", tree_id: "tree_003" },
                { slug: "visual", name: "Visual", status: "active", tree_id: "tree_003" },
                { slug: "linkedin", name: "LinkedIn", status: "active", tree_id: "tree_003" },
                { slug: "b2b", name: "B2B", status: "active", tree_id: "tree_003" }
            ]
        };

        // State management
        let currentFilters = {
            tree: 'all',
            status: 'all',
            type: 'all',
            search: ''
        };

        // Initialize the application
        function init() {
            populateTreeSelect();
            renderStats();
            renderTreeVisualization();
            renderTagCloud();
            renderDataInspector();
            setupEventListeners();
        }

        function populateTreeSelect() {
            const select = document.getElementById('treeSelect');
            seedData.trees.forEach(tree => {
                const option = document.createElement('option');
                option.value = tree.id;
                option.textContent = tree.name;
                select.appendChild(option);
            });
        }

        function renderStats() {
            const activeAreas = seedData.areas.filter(area => area.status === 'active').length;
            const activeTags = seedData.tags.filter(tag => tag.status === 'active').length;
            
            document.getElementById('statTrees').textContent = seedData.trees.length;
            document.getElementById('statClusters').textContent = getAllClusters().length;
            document.getElementById('statAreas').textContent = seedData.areas.length;
            document.getElementById('statTags').textContent = activeTags;
        }

        function getAllClusters() {
            return seedData.trees.reduce((acc, tree) => acc.concat(tree.clusters), []);
        }

        function renderTreeVisualization() {
            const container = document.getElementById('treeViz');
            container.innerHTML = '';
            
            const width = container.clientWidth;
            const height = 600;
            
            const svg = d3.select('#treeViz')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const g = svg.append('g')
                .attr('transform', 'translate(50,50)');

            // Create hierarchical data
            const treeData = createHierarchicalData();
            
            // Create tree layout
            const tree = d3.tree()
                .size([width - 100, height - 100]);

            const root = d3.hierarchy(treeData);
            tree(root);

            // Draw links
            g.selectAll('.tree-link')
                .data(root.descendants().slice(1))
                .enter().append('path')
                .attr('class', 'tree-link')
                .attr('d', d => {
                    return `M${d.x},${d.y}
                            C${d.x},${(d.y + d.parent.y) / 2}
                             ${d.parent.x},${(d.y + d.parent.y) / 2}
                             ${d.parent.x},${d.parent.y}`;
                });

            // Draw nodes
            const node = g.selectAll('.tree-node')
                .data(root.descendants())
                .enter().append('g')
                .attr('class', 'tree-node')
                .attr('transform', d => `translate(${d.x},${d.y})`);

            // Add circles for nodes
            node.append('circle')
                .attr('r', d => d.data.type === 'tree' ? 12 : d.data.type === 'cluster' ? 8 : 6)
                .style('fill', d => {
                    if (d.data.type === 'tree') return 'var(--nf-primary-500)';
                    if (d.data.type === 'cluster') return 'var(--nf-accent-cyan)';
                    return 'var(--nf-success)';
                })
                .style('stroke', 'var(--nf-gray-400)')
                .style('stroke-width', '2px');

            // Add labels
            node.append('text')
                .attr('dy', d => d.data.type === 'tree' ? -18 : -12)
                .attr('text-anchor', 'middle')
                .style('fill', 'var(--nf-gray-200)')
                .style('font-size', d => d.data.type === 'tree' ? '14px' : '12px')
                .style('font-weight', d => d.data.type === 'tree' ? '600' : '400')
                .text(d => d.data.name);

            // Add status indicators
            node.filter(d => d.data.status)
                .append('circle')
                .attr('r', 3)
                .attr('cx', 15)
                .attr('cy', -8)
                .style('fill', d => d.data.status === 'active' ? 'var(--nf-success)' : 'var(--nf-error)')
                .style('stroke', 'var(--nf-gray-800)')
                .style('stroke-width', '1px');

            // Add click handlers
            node.on('click', function(event, d) {
                showNodeDetails(d.data);
            });
        }

        function createHierarchicalData() {
            const filtered = getFilteredData();
            
            return {
                name: "API Root",
                type: "root",
                children: filtered.trees.map(tree => ({
                    name: tree.name,
                    type: "tree",
                    id: tree.id,
                    status: tree.status,
                    children: tree.clusters
                        .filter(cluster => !cluster.parent_id)
                        .map(cluster => createClusterNode(cluster, tree.clusters, filtered.areas))
                }))
            };
        }

        function createClusterNode(cluster, allClusters, areas) {
            const childClusters = allClusters.filter(c => c.parent_id === cluster.uid);
            const clusterAreas = areas.filter(area => area.cluster_uid === cluster.uid);
            
            return {
                name: cluster.name,
                type: "cluster",
                id: cluster.uid,
                status: cluster.status,
                children: [
                    ...childClusters.map(child => createClusterNode(child, allClusters, areas)),
                    ...clusterAreas.map(area => ({
                        name: area.name,
                        type: "area",
                        id: area.uid,
                        status: area.status,
                        tags: area.tags
                    }))
                ]
            };
        }

        function getFilteredData() {
            let filteredTrees = seedData.trees;
            let filteredAreas = seedData.areas;

            // Filter by tree
            if (currentFilters.tree !== 'all') {
                filteredTrees = filteredTrees.filter(tree => tree.id === currentFilters.tree);
                const treeClusterIds = filteredTrees.reduce((acc, tree) => 
                    acc.concat(tree.clusters.map(c => c.uid)), []);
                filteredAreas = filteredAreas.filter(area => 
                    treeClusterIds.includes(area.cluster_uid));
            }

            // Filter by status
            if (currentFilters.status === 'active') {
                filteredTrees = filteredTrees.filter(tree => tree.status === 'active');
                filteredAreas = filteredAreas.filter(area => area.status === 'active');
                filteredTrees.forEach(tree => {
                    tree.clusters = tree.clusters.filter(cluster => cluster.status === 'active');
                });
            }

            // Filter by type
            if (currentFilters.type === 'clusters') {
                filteredAreas = [];
            } else if (currentFilters.type === 'areas') {
                filteredTrees.forEach(tree => {
                    tree.clusters = tree.clusters.filter(cluster => 
                        filteredAreas.some(area => area.cluster_uid === cluster.uid));
                });
            }

            // Filter by search
            if (currentFilters.search) {
                const searchTerm = currentFilters.search.toLowerCase();
                filteredAreas = filteredAreas.filter(area => 
                    area.name.toLowerCase().includes(searchTerm) ||
                    area.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                );
                
                filteredTrees.forEach(tree => {
                    tree.clusters = tree.clusters.filter(cluster =>
                        cluster.name.toLowerCase().includes(searchTerm) ||
                        filteredAreas.some(area => area.cluster_uid === cluster.uid)
                    );
                });
                
                filteredTrees = filteredTrees.filter(tree =>
                    tree.name.toLowerCase().includes(searchTerm) ||
                    tree.clusters.length > 0
                );
            }

            return { trees: filteredTrees, areas: filteredAreas };
        }

        function renderTagCloud() {
            const container = document.getElementById('tagCloud');
            container.innerHTML = '';
            
            const filtered = getFilteredData();
            const tagCounts = {};
            
            // Count tag usage
            filtered.areas.forEach(area => {
                area.tags.forEach(tag => {
                    tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                });
            });
            
            // Add cluster and area names as tags
            filtered.trees.forEach(tree => {
                tree.clusters.forEach(cluster => {
                    tagCounts[cluster.name] = (tagCounts[cluster.name] || 0) + 2;
                });
            });
            
            filtered.areas.forEach(area => {
                tagCounts[area.name] = (tagCounts[area.name] || 0) + 1;
            });

            // Sort by frequency
            const sortedTags = Object.entries(tagCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 50);

            sortedTags.forEach(([tag, count]) => {
                const badge = document.createElement('span');
                badge.className = 'tag-badge';
                badge.textContent = `${tag} (${count})`;
                
                // Determine tag type and color
                const isCluster = filtered.trees.some(tree => 
                    tree.clusters.some(cluster => cluster.name === tag));
                const isArea = filtered.areas.some(area => area.name === tag);
                
                if (isCluster) {
                    badge.classList.add('tag-cluster');
                } else if (isArea) {
                    badge.classList.add('tag-area');
                } else {
                    badge.classList.add('tag-status-active');
                }
                
                // Add click handler for filtering
                badge.addEventListener('click', () => {
                    currentFilters.search = tag;
                    document.getElementById('searchInput').value = tag;
                    updateDisplay();
                });
                
                container.appendChild(badge);
            });
        }

        function renderDataInspector() {
            const container = document.getElementById('dataInspector');
            container.innerHTML = '';
            
            const filtered = getFilteredData();
            
            filtered.trees.forEach(tree => {
                const treeCard = document.createElement('div');
                treeCard.className = 'nf-card rounded-lg p-4 mb-4';
                
                treeCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-display text-lg font-semibold">${tree.name}</h3>
                        <span class="tag-badge ${tree.status === 'active' ? 'tag-status-active' : 'tag-status-inactive'}">
                            ${tree.status}
                        </span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${tree.clusters.map(cluster => `
                            <div class="border rounded-lg p-3" style="border-color: var(--nf-gray-600);">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-semibold text-sm">${cluster.name}</h4>
                                    <span class="tag-badge tag-cluster text-xs">${cluster.status}</span>
                                </div>
                                <div class="space-y-1">
                                    ${filtered.areas
                                        .filter(area => area.cluster_uid === cluster.uid)
                                        .map(area => `
                                            <div class="flex items-center justify-between text-xs">
                                                <span style="color: var(--nf-gray-400)">${area.name}</span>
                                                <span class="tag-badge ${area.status === 'active' ? 'tag-status-active' : 'tag-status-inactive'}" style="font-size: 0.6rem; padding: 0.125rem 0.375rem;">
                                                    ${area.status}
                                                </span>
                                            </div>
                                            <div class="flex flex-wrap gap-1 mt-1">
                                                ${area.tags.map(tag => `
                                                    <span class="tag-badge tag-area" style="font-size: 0.6rem; padding: 0.125rem 0.25rem;">${tag}</span>
                                                `).join('')}
                                            </div>
                                        `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(treeCard);
            });
        }

        function showNodeDetails(nodeData) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.style.backdropFilter = 'blur(8px)';
            
            const content = document.createElement('div');
            content.className = 'nf-card rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto';
            
            let details = '';
            if (nodeData.type === 'tree') {
                const tree = seedData.trees.find(t => t.id === nodeData.id);
                details = `
                    <h3 class="font-display text-xl font-semibold mb-4">Tree: ${tree.name}</h3>
                    <div class="space-y-2">
                        <p><strong>ID:</strong> ${tree.id}</p>
                        <p><strong>Status:</strong> <span class="tag-badge ${tree.status === 'active' ? 'tag-status-active' : 'tag-status-inactive'}">${tree.status}</span></p>
                        <p><strong>Created:</strong> ${new Date(tree.created_at).toLocaleString()}</p>
                        <p><strong>Clusters:</strong> ${tree.clusters.length}</p>
                        <p><strong>Total Areas:</strong> ${seedData.areas.filter(a => tree.clusters.some(c => c.uid === a.cluster_uid)).length}</p>
                    </div>
                `;
            } else if (nodeData.type === 'cluster') {
                const cluster = getAllClusters().find(c => c.uid === nodeData.id);
                const areas = seedData.areas.filter(a => a.cluster_uid === cluster.uid);
                details = `
                    <h3 class="font-display text-xl font-semibold mb-4">Cluster: ${cluster.name}</h3>
                    <div class="space-y-2">
                        <p><strong>UID:</strong> ${cluster.uid}</p>
                        <p><strong>Status:</strong> <span class="tag-badge ${cluster.status === 'active' ? 'tag-status-active' : 'tag-status-inactive'}">${cluster.status}</span></p>
                        <p><strong>Parent:</strong> ${cluster.parent_id || 'Root'}</p>
                        <p><strong>Children:</strong> ${cluster.children.length}</p>
                        <p><strong>Areas:</strong> ${areas.length}</p>
                        <div class="mt-3">
                            <h4 class="font-semibold mb-2">Areas:</h4>
                            <div class="grid grid-cols-1 gap-2">
                                ${areas.map(area => `
                                    <div class="border rounded p-2" style="border-color: var(--nf-gray-600);">
                                        <div class="flex justify-between items-center">
                                            <span>${area.name}</span>
                                            <span class="tag-badge ${area.status === 'active' ? 'tag-status-active' : 'tag-status-inactive'}">${area.status}</span>
                                        </div>
                                        <div class="flex flex-wrap gap-1 mt-1">
                                            ${area.tags.map(tag => `<span class="tag-badge tag-area">${tag}</span>`).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } else if (nodeData.type === 'area') {
                const area = seedData.areas.find(a => a.uid === nodeData.id);
                details = `
                    <h3 class="font-display text-xl font-semibold mb-4">Area: ${area.name}</h3>
                    <div class="space-y-2">
                        <p><strong>UID:</strong> ${area.uid}</p>
                        <p><strong>Status:</strong> <span class="tag-badge ${area.status === 'active' ? 'tag-status-active' : 'tag-status-inactive'}">${area.status}</span></p>
                        <p><strong>Cluster:</strong> ${area.cluster_uid}</p>
                        <div class="mt-3">
                            <h4 class="font-semibold mb-2">Tags:</h4>
                            <div class="flex flex-wrap gap-1">
                                ${area.tags.map(tag => `<span class="tag-badge tag-area">${tag}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = `
                ${details}
                <div class="mt-6 flex justify-end">
                    <button class="nf-btn-primary px-4 py-2 rounded-lg" onclick="this.closest('.fixed').remove()">
                        Close
                    </button>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function updateDisplay() {
            renderStats();
            renderTreeVisualization();
            renderTagCloud();
            renderDataInspector();
        }

        function setupEventListeners() {
            // Tree selector
            document.getElementById('treeSelect').addEventListener('change', (e) => {
                currentFilters.tree = e.target.value;
                updateDisplay();
            });

            // Filter buttons
            document.getElementById('filterActive').addEventListener('click', (e) => {
                currentFilters.status = currentFilters.status === 'active' ? 'all' : 'active';
                e.target.classList.toggle('filter-active');
                updateDisplay();
            });

            document.getElementById('filterClusters').addEventListener('click', (e) => {
                currentFilters.type = currentFilters.type === 'clusters' ? 'all' : 'clusters';
                e.target.classList.toggle('filter-active');
                updateDisplay();
            });

            document.getElementById('filterAreas').addEventListener('click', (e) => {
                currentFilters.type = currentFilters.type === 'areas' ? 'all' : 'areas';
                e.target.classList.toggle('filter-active');
                updateDisplay();
            });

            // Reset filters
            document.getElementById('resetFilters').addEventListener('click', () => {
                currentFilters = { tree: 'all', status: 'all', type: 'all', search: '' };
                document.getElementById('treeSelect').value = 'all';
                document.getElementById('searchInput').value = '';
                document.querySelectorAll('.filter-active').forEach(btn => btn.classList.remove('filter-active'));
                updateDisplay();
            });

            // Search input
            document.getElementById('searchInput').addEventListener('input', (e) => {
                currentFilters.search = e.target.value;
                updateDisplay();
            });

            // Expand/Collapse (placeholder functionality)
            document.getElementById('expandAll').addEventListener('click', () => {
                // Would expand all tree nodes in a real implementation
                console.log('Expand all nodes');
            });

            document.getElementById('collapseAll').addEventListener('click', () => {
                // Would collapse all tree nodes in a real implementation
                console.log('Collapse all nodes');
            });

            // Window resize handler
            window.addEventListener('resize', () => {
                setTimeout(() => {
                    renderTreeVisualization();
                }, 100);
            });
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>